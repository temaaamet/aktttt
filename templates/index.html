
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Генератор акта</title>
  <script>
    function toTitleCase(str) {
      return str
        .split(" ")
        .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
        .join(" ");
    }

    function numToWords(n) {
      const rub = Intl.NumberFormat("ru-RU", { style: "currency", currency: "RUB", currencyDisplay: "name" }).format(n);
      let [r, k] = n.toFixed(2).split(".");
      const words = rub.toUpperCase().replace(/РУБЛЬ.*$/, "РУБЛЕЙ");
      return `${words} ${k} КОПЕЕК`;
    }

    async function generateAct() {
      const day = document.getElementById("day").value;
      const month = document.getElementById("month").value;
      const act_number = document.getElementById("act_number").value;
      const fio = toTitleCase(document.getElementById("fio").value.trim());
      const inn = document.getElementById("inn").value;
      const contract_number = document.getElementById("contract_number").value;
      const qty = parseInt(document.getElementById("qty").value);
      const rub = parseInt(document.getElementById("rub").value);
      const kop = parseInt(document.getElementById("kop").value);

      if (
        day === "" ||
        !/^[0-3]?[0-9]$/.test(day) ||
        parseInt(day) > 31 ||
        isNaN(qty) ||
        isNaN(rub) ||
        isNaN(kop) ||
        !fio ||
        !/^\d{12}$/.test(inn) ||
        !contract_number ||
        !act_number ||
        month === ""
      ) {
        alert("Пожалуйста, заполните все поля корректно.");
        return;
      }

      const total = qty * (rub + kop / 100);
      const sum_words = numToWords(total);

      const response = await fetch("/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          day, month, act_number, fio, inn,
          contract_number, qty, rub, kop,
          sum_total: total.toFixed(2),
          sum_words
        })
      });

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `Акт_№${act_number}_от_${day}_${month}.docx`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }
  </script>
</head>
<body>
  <h2>Форма для генерации акта</h2>
  <label>Номер акта: <input id="act_number" required type="text"></label><br><br>
  <label>День: <input id="day" required type="number" min="1" max="31" pattern="[0-3]?[0-9]"></label><br><br>
  <label>Месяц:
    <select id="month" required>
      <option value="января">января</option>
      <option value="февраля">февраля</option>
      <option value="марта">марта</option>
      <option value="апреля">апреля</option>
      <option value="мая">мая</option>
      <option value="июня">июня</option>
      <option value="июля">июля</option>
      <option value="августа">августа</option>
      <option value="сентября">сентября</option>
      <option value="октября">октября</option>
      <option value="ноября">ноября</option>
      <option value="декабря">декабря</option>
    </select>
  </label><br><br>
  <label>ФИО исполнителя: <input id="fio" required type="text"></label><br><br>
  <label>ИНН исполнителя: <input id="inn" required type="text" maxlength="12" pattern="\d{12}" title="12 цифр"></label><br><br>
  <label>Номер договора: <input id="contract_number" required type="text"></label><br><br>
  <label>Кол-во автомобилей: <input id="qty" required type="number"></label><br><br>
  <label>Цена за 1 шт (руб): <input id="rub" required type="number" min="0"></label><br>
  <label>Копеек: <input id="kop" required type="number" min="0" max="99"></label><br><br>
  <button onclick="generateAct()">Сформировать и скачать .docx</button>
</body>
</html>
